<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Installation & Testing Guide</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            line-height: 1.6;
            background: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 5px;
        }
        .step h3 {
            margin-top: 0;
            color: #007bff;
        }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .fix-list {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
        }
        ul, ol {
            padding-left: 25px;
        }
        li {
            margin: 8px 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Element AI Extractor - Communication Fix Testing Guide</h1>
        
        <div class="success">
            <strong>‚úÖ Fixes Applied:</strong> The "Could not establish connection. Receiving end does not exist" error has been addressed with multiple improvements.
        </div>

        <div class="fix-list">
            <h3>üõ†Ô∏è Applied Fixes</h3>
            <ul>
                <li><strong>Enhanced Content Script Protection:</strong> Prevents duplicate loading with fallback listeners</li>
                <li><strong>Improved Ping System:</strong> Better timeout handling (1.5s) and enhanced response data</li>
                <li><strong>Robust Message Handling:</strong> All message handlers properly return `true` to keep channels open</li>
                <li><strong>Better Error Detection:</strong> Specific handling for connection errors with retry logic</li>
                <li><strong>Enhanced Debugging:</strong> Comprehensive logging for troubleshooting</li>
                <li><strong>Fallback Injection:</strong> Automatic content script injection when manifest injection fails</li>
            </ul>
        </div>

        <div class="step">
            <h3>Step 1: Install the Extension</h3>
            <ol>
                <li>Open Chrome and navigate to <code>chrome://extensions/</code></li>
                <li>Enable "Developer mode" (toggle in top-right corner)</li>
                <li>Click "Load unpacked"</li>
                <li>Select the folder: <code>/Users/arog/ADP/ElementsExtractorV1/bots/elementsExtractor/</code></li>
                <li>The extension should appear with the "Element AI Extractor" icon</li>
            </ol>
            
            <div class="warning">
                <strong>‚ö†Ô∏è Important:</strong> If you had the extension loaded before, click the refresh button (üîÑ) next to the extension to reload it with the new fixes.
            </div>
        </div>

        <div class="step">
            <h3>Step 2: Test Basic Functionality</h3>
            <ol>
                <li>Open the test page: <a href="http://localhost:8080/test-communication-fix.html" class="test-button" target="_blank">Open Test Page</a></li>
                <li>Click the extension icon in the Chrome toolbar</li>
                <li>Click "Start Inspecting" in the popup</li>
                <li>You should see the inspection mode activate without connection errors</li>
                <li>Try clicking different elements on the test page</li>
            </ol>
        </div>

        <div class="step">
            <h3>Step 3: Test Edge Cases</h3>
            <ul>
                <li><strong>Page Reload:</strong> Reload the test page and try inspecting immediately</li>
                <li><strong>Multiple Tabs:</strong> Open the test page in multiple tabs and test each</li>
                <li><strong>iframe Content:</strong> Try inspecting elements inside the iframe on the test page</li>
                <li><strong>Dynamic Content:</strong> Use the "Add New Element" button and inspect the new elements</li>
            </ul>
        </div>

        <div class="step">
            <h3>Step 4: Monitor Browser Console</h3>
            <ol>
                <li>Open Chrome DevTools (F12)</li>
                <li>Go to the Console tab</li>
                <li>Look for messages starting with "Element AI Extractor:"</li>
                <li>You should see successful ping responses and no connection errors</li>
            </ol>
            
            <div class="code">
Expected Console Output:
Element AI Extractor: Content script loaded and initializing...
Element AI Extractor: Chrome runtime API available  
Element AI Extractor: Responding to ping
Element AI Extractor: Content script is responsive, proceeding with inspection
            </div>
        </div>

        <div class="step">
            <h3>Step 5: Test Different Page Types</h3>
            <p>Test the extension on various types of pages:</p>
            <ul>
                <li><strong>Local HTML files:</strong> file:// URLs (should show restriction message)</li>
                <li><strong>HTTPS sites:</strong> Regular websites</li>
                <li><strong>HTTP sites:</strong> Local development servers</li>
                <li><strong>Complex SPAs:</strong> React/Angular applications</li>
            </ul>
        </div>

        <div class="step">
            <h3>Step 6: Verify Fixed Behaviors</h3>
            <div class="success">
                <h4>‚úÖ What Should Work Now:</h4>
                <ul>
                    <li>No "Could not establish connection" errors</li>
                    <li>Inspection starts immediately without delays</li>
                    <li>Page reloads don't break the extension</li>
                    <li>Content script properly re-injects when needed</li>
                    <li>Better error messages for unsupported pages</li>
                    <li>Improved stability across different page types</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h3>üêõ Troubleshooting</h3>
            <p>If you still encounter issues:</p>
            <ol>
                <li><strong>Check Extension Reload:</strong> Make sure you reloaded the extension after applying fixes</li>
                <li><strong>Clear Browser Cache:</strong> Hard refresh (Ctrl+Shift+R) the test pages</li>
                <li><strong>Check Console Errors:</strong> Look for any remaining error messages</li>
                <li><strong>Test Different Pages:</strong> Some pages may have Content Security Policy restrictions</li>
                <li><strong>Extension Permissions:</strong> Ensure the extension has permission for the current site</li>
            </ol>
            
            <div class="warning">
                <strong>Still Having Issues?</strong> Check the browser console for specific error messages and compare with the expected output above.
            </div>
        </div>

        <div class="step">
            <h3>üìä Performance Improvements</h3>
            <p>The fixes also include these performance enhancements:</p>
            <ul>
                <li><strong>Faster Connection Testing:</strong> Reduced ping timeout from 2s to 1.5s</li>
                <li><strong>Smarter Script Loading:</strong> Prevents unnecessary duplicate injections</li>
                <li><strong>Better Error Recovery:</strong> Automatic retry with exponential backoff</li>
                <li><strong>Enhanced State Management:</strong> Global state tracking prevents conflicts</li>
            </ul>
        </div>

        <h2>üéØ Test Results Expected</h2>
        <p>After applying these fixes, you should experience:</p>
        
        <div class="success">
            <ul>
                <li><strong>Zero Connection Errors:</strong> No more "Receiving end does not exist" messages</li>
                <li><strong>Instant Response:</strong> Extension popup responds immediately</li>
                <li><strong>Reliable Inspection:</strong> Element inspection works consistently</li>
                <li><strong>Better User Feedback:</strong> Clear status messages during operation</li>
                <li><strong>Robust Recovery:</strong> Handles page reloads and navigation gracefully</li>
            </ul>
        </div>

        <p><strong>üìù Report any remaining issues with specific error messages and steps to reproduce.</strong></p>
    </div>
</body>
</html>
